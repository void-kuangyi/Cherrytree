Disabled Appendix: Summarised history of Harlowe's design

You may have a number of questions about various aspects of Harlowe's design. For posterity, I'd like to use this section to chronicle my motivations for most of Harlowe's major divergences from Twine 1, point out several of its outside inspirations, and describe how several of its own idiosyncracies came to be.

## Twine is not a web programming lesson

One of the major dissatisfactions I had with Twine 1 was that it allegedly aspired to simplicity for the beginner, but truly grappling with it demanded the author understand five entirely different programming languages: TiddlyWiki markup, macro tags, CSS, HTML tags, and Javascript expressions within macros. The latter three were not designed into the Twine platform, but leaked through from the hosting environment (the web platform) as a matter of convenience, filling functionality that Twine was lacking, with its own, largely incompatible, idiosyncracies. While only the top two were strictly necessary for the simplest and most common Twine use-cases, the fact that the latter three demand understanding an entirely different grammar and which isn't documented alongside Twine's own languages.

Some might say that learning these languages provides the author with the benefit of understanding web programming, from which they can embark on more ambitious post-Twine projects. I contend that as a dev tool, Twine's job is absolutely not to be a web programming lesson, and any design decision that made it more useful in teaching web programming languages than its own languages should be held in high suspicion.

One of the languages whose strong presence in Twine I resented was Javascript. Infamous for its beginner-unfriendly idiosyncracies like automatic type conversion and "forgiving" silent failures in place of error messages, this language was nonetheless thinly concealed in Twine 1 beneath some buggy syntactic sugar. Basic services like arithmetic, string concatenation and so forth all deferred to Javascript unfiltered, bringing forth whatever `undefined`s or `NaN`s it chose to return. I knew that beginning Twine users deserved better than this.

For Harlowe, I made it a goal, lofty as it was, to pull down as much basic functionality as I could from the inhospitable peaks of CSS and Javascript to the macro layer - to include a proper programming language with its own operators, error messages and broad macro library that protected the author from CSS and Javascript's jagged edges as much as possible. This goal guided many of my decisions from here on.

## Macro syntax

Users of the default story format in Twine 1 know that they are "powered by TiddlyWiki", as they proudly proclaim. This reflects their codebase's origin as a fork of [TiddlyWiki](https://classic.tiddlywiki.com/), a single-page-app wiki. (Twee, the command-line predecessor to Twine, is named after TiddlyWiki, and "Twine", the windowed successor, is just a clever portmanteau of "windowed" + "Twee".) Each passage is actually, from the runtime's point of view, a wiki article (a "tiddler"), though by now all of TiddlyWiki's code has been heavily developed beyond recognition. 

A lot of TiddlyWiki's syntax was used verbatim in the story formats, and remains to this day, such as the delineators for text styling and comments, or the `<html>` blocks to hold "raw HTML". More importantly, however, the macro syntax (and the term "macro" itself) and its delineators `<<` and `>>` remained. These were clearly based on HTML tags - the name of the macro and its arguments are separated solely by whitespace, and macros designed to enclose a block, such as `<<if>>`, required a matching `<<endif>>`. To distinguish them from actual HTML, of course, the brackets were doubled.

I'd always had misgivings with the Twine 1 macro syntax, all of which were rooted in its use of angle brackets. This choice of delimiter had already impacted other aspects of the syntax: due to a limitation of the parser in an early Twine version, the `>` and `<` symbols couldn't be used as operators inside macros, resulting in awkward `gt` and `lt` operators being created instead (though this was eventually fixed, these operators had become entrenched in what few Twine tutorials existed at the time, including Anna Anthropy's). Furthermore, due to the use of doubled brackets, nesting macros inside each other was out of the question: designing a custom macro for nesting, like `<<set $a to <<visited "Penthouse">>>>`, would be visually unreadable. Instead, Javascript functions were used for nested calls, such as `<<set $a to visited("Penthouse")>>` - a somewhat awkward and clashing second tier of programming, distinct from the macro layer.

Despite these specific issues, however, I've always found "angle brackets" delimiters ugly and visually displeasing. For one, they're not true angle brackets, like `⟨ ⟩`, but repurposed ASCII greater-than and less-than signs, which are wider than they are tall, and so barely appear to enclose their contents.

So, why are angle-brackets used by HTML, currently the most pervasive markup format on the planet? HTML was derived from [SGML](https://en.wikipedia.org/wiki/Standard_Generalized_Markup_Language), a prevalent 1980s markup format and predecessor of XML, which used them in its default concrete syntax (which, unlike HTML and XML, could be configured to use different symbols).

In mid-2013, while working on the first release of Harlowe, I learned a mind-opening fact: Tim Berners-Lee, in his [original announcement of World Wide Web](https://groups.google.com/d/msg/alt.hypertext/eCTkkOoWTAY/urNMgHnS2gYJ) felt it necessary to leverage the existing SGML standard and toolchains, but, *from the moment of HTML's inception*, regretted angle brackets:

![](data:image/png;base64,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)

Some weeks after I learned this - a truly incisive example of how bad design decisions perpetuate themselves, even against their human designers' will, unless someone riskily strives to rebuke them - I felt motivated to take the initiative and rethink the macro syntax. Twine is a sufficiently young, niche language that making a sharp break in its most important syntax would not be too costly, and to ignore this opportunity for a new codebase would be foolish.

As mentioned above, the double-layer of function vs macro was additionally weighing on my mind, and my first move was to replace macro syntax entirely with function syntax as-is - one could place `visited("Penthouse")` in both the passage text and the interior of a macro call, and it would behave the same. (One could amusingly see parallels between XML, a HTML-derived data file format, being replaced by JSON, a Javascript-derived format, but such parallels were not on my mind at the time.) Of course, the obvious issue with not being able to embed macros directly next to readable text, such as `THUNDERuppercase($weapontype)`, as well as the equally obvious collisions with prose parens like `person(s)`, would cause me to soon tweak the function syntax to something more LISP-like: `THUNDER(uppercase:$weapontype)`. Unlike LISP, though, the presence of a `:` between name and arguments, which is mandatory even for zero-arity calls like `(stop:)`, is the single detail that separates prose parens from code parens. (While there are still plenty of possible prose collisions, those were, in my mind at the time, vanishingly smaller in number than those caused by the prior syntax.)

The `:`, as well as the residual use of `,` for argument separation, had another characteristic that I liked: clearly indicating to the writer the structure of the syntax, where the name stops and the arguments start, and hopefully precluding people thinking of the macro call as this atomic, monolithic invocation where, say, `if` is always followed by one space and a `$`.

It was at the same time as I was reinventing the macro syntax that I was also devising the "hook" structure, which would step in at this time and obviate the need for `(endif:)` and other HTML-style end-tag macros, in a way completing the sundering of SGML's legacy. So, let's turn to discuss where hooks came from:

## Hooks

*It was at this point in the story that Leon was called away from the fire by impending business, leaving the rest untold.*
